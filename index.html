<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive YouTube Video (Portrait)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;500;600&display=swap" rel="stylesheet">

<style>
body {
  background:#0f0f0f;
  color:#eee;
  font-family:'Assistant',sans-serif;
  display:flex;
  justify-content:center;
  margin-top:20px;
}

.wrapper {
  width:100%;
  max-width:420px;
  padding:0 10px;
}

.label {
  font-size:13px;
  color:#aaa;
  margin-bottom:6px;
}

input[type="text"] {
  width:100%;
  padding:9px 12px;
  font-size:15px;
  margin-bottom:10px;
  background:linear-gradient(#1a1a1a,#151515);
  color:#eee;
  border:1px solid #333;
  border-radius:6px;
}

.control-bar {
  display:flex;
  align-items:center;
  gap:10px;
  padding:8px 10px;
  margin-bottom:12px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:8px;
  font-size:13px;
  color:#ccc;
}

.player-wrap {
  position:relative;
  width:100%;
  aspect-ratio:9/16;
  background:black;
  overflow:hidden;
  border-radius:10px;
}

iframe {
  width:100%;
  height:100%;
  border:none;
}

#subs {
  position:absolute;
  top:56%;
  left:50%;
  transform:translateX(calc(-50% - 8px));
  width:calc(76% + 10px);

  padding:10px 14px;
  background:rgba(0,0,0,0.38);
  border-radius:14px;

  backdrop-filter:blur(6px);
  -webkit-backdrop-filter:blur(6px);

  font-size:13.5px;
  line-height:1.45;
  color:#f2f2f2;

  text-shadow:0 1px 2px rgba(0,0,0,0.6);
  box-sizing:border-box;
  min-height:3.2em;

  user-select:none;
  pointer-events:none;
}

#subs.mc {
  transform:translateX(calc(-50% + 30px));
  width:calc(76% - 30px);
}

#subs.spoken {
  background: rgba(255,255,255,0.55);
  color: #444;
  text-shadow: none;
}

#subs.hidden {
  display:none;
}

#mc-name-box {
  position:absolute;
  top:55.2%;
  left:50%;
  transform: translateX(calc(-50% - 44px)) translateY(calc(-82% - 1px));

  padding:4px 12px;
  min-width:54px;
  text-align:center;

  font-size:13px;
  font-weight:600;
  color:#fff;

  background: linear-gradient(
  90deg,
  #e57e8d 0%,
  #e98f9c 55%,
  #efb1ba 100%
);
  border-radius:12px;
  box-shadow:
  0 2px 6px rgba(0,0,0,0.18),
  0 0 8px rgba(229,126,141,0.45);

  white-space:nowrap;
  user-select:none;
  pointer-events:none;
}

#mc-name-box.hidden {
  display:none;
}
</style>
</head>

<body>
<div class="wrapper">

  <div class="label">Type your name here</div>
  <input id="mcName" type="text" value="MC">

  <div class="control-bar">
    <label>
      <input type="checkbox" id="toggleCC" checked>
      Show subtitles
    </label>
    <span style="font-size:12.5px;color:#aaa;">
      Avoid fullscreen for subtitles to work
    </span>
  </div>

  <div class="player-wrap">
    <iframe
      id="yt-frame"
      src="https://www.youtube.com/embed/N1Gowi2WbIg?enablejsapi=1&playsinline=1"
      allow="encrypted-media; fullscreen"
      allowfullscreen>
    </iframe>

    <!-- ADDED: MC name box -->
    <div id="mc-name-box" class="hidden"></div>

    <div id="subs" class="hidden"></div>
  </div>

</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let ytPlayer;
let subtitles = [];
let subsEnabled = true;

function onYouTubeIframeAPIReady() {
  ytPlayer = new YT.Player('yt-frame', {
    events: {
      onReady: () => {
        fetch('subs.srt')
          .then(r => r.text())
          .then(parseSRT)
          .then(d => subtitles = d);
      }
    }
  });

  setInterval(updateSubs, 120);
}

function parseSRT(data) {
  return data.replace(/\r/g,'')
    .trim()
    .split(/\n\n+/)
    .map(b=>{
      const l=b.split('\n');
      if(l.length<2) return null;
      const [s,e]=l[1].split(' --> ').map(toSec);
      return {start:s,end:e,text:l.slice(2).join(' ')};
    })
    .filter(Boolean);
}

function toSec(t){
  const [h,m,s]=t.replace(',','.').split(':');
  return h*3600+m*60+parseFloat(s);
}

function updateSubs(){
  const box = document.getElementById('subs');
  const nameBox = document.getElementById('mc-name-box');

  if(!ytPlayer?.getCurrentTime || !subsEnabled){
    box.classList.add('hidden');
    nameBox.classList.add('hidden');
    return;
  }

  const t = ytPlayer.getCurrentTime();
  const mcName = document.getElementById('mcName').value.trim() || 'MC';

  const line = subtitles.find(s => t >= s.start && t <= s.end);
  if(!line){
    box.classList.add('hidden');
    nameBox.classList.add('hidden');
    return;
  }

  let rawText = line.text;

  const hasSpeaker = /^[A-Za-z\u4e00-\u9fa5][A-Za-z\u4e00-\u9fa5 .]{0,15}[:：]\s/.test(rawText);
  const isMC = rawText.startsWith('MC:') || rawText.startsWith('MC：');

  let dialogue = rawText.replace(/^[^:：]+[:：]\s*/, '');
  dialogue = dialogue.replace(/\bMC\b(?=[^\w]|$)/g, mcName);

  box.textContent = dialogue;

  box.classList.toggle('mc', isMC);
  box.classList.toggle('spoken', hasSpeaker);
  box.classList.remove('hidden');

  if(isMC){
    nameBox.textContent = mcName;
    nameBox.classList.remove('hidden');
  } else {
    nameBox.classList.add('hidden');
  }
}

document.getElementById('toggleCC').addEventListener('change', e => {
  subsEnabled = e.target.checked;
  if(!subsEnabled){
    document.getElementById('subs').classList.add('hidden');
    document.getElementById('mc-name-box').classList.add('hidden');
  }
});
</script>
</body>
</html>
